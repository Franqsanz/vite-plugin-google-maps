{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Plugin } from \"vite\";\r\nimport path from \"node:path\";\r\n// import { fileURLToPath } from \"node:url\";\r\nimport fs from \"node:fs\";\r\n\r\nimport type { GoogleMapsPluginOptions } from \"./interfaces\";\r\n\r\n// const __filename = fileURLToPath(import.meta.url);\r\n// const __dirname = path.dirname(__filename);\r\n\r\nexport function GoogleMapsPlugin(options: GoogleMapsPluginOptions): Plugin {\r\n  const {\r\n    apiKey,\r\n    libraries = [\"places\"],\r\n    debug = false,\r\n    mapDefaults = {},\r\n  } = options;\r\n\r\n  if (!apiKey || typeof apiKey !== \"string\" || apiKey.trim() === \"\") {\r\n    const msg =\r\n      `\\n⚠️  [vite-plugin-google-maps]\\n` +\r\n      `No se proporcionó una apiKey de Google Maps.\\n` +\r\n      `El provider NO podrá cargar la API.\\n`;\r\n\r\n    if (process.env.NODE_ENV === \"production\") {\r\n      throw new Error(msg);\r\n    } else {\r\n      console.warn(msg);\r\n    }\r\n  }\r\n\r\n  const pkgPath = path.resolve(\r\n    process.cwd(),\r\n    \"node_modules/@vis.gl/react-google-maps\"\r\n  );\r\n\r\n  if (!fs.existsSync(pkgPath)) {\r\n    console.warn(\r\n      `\\n⚠️  [vite-plugin-google-maps]\\n` +\r\n        `La librería \"@vis.gl/react-google-maps\" NO está instalada.\\n\\n` +\r\n        `  npm install @vis.gl/react-google-maps\\n`\r\n    );\r\n  }\r\n\r\n  // Wrapper del Map component con Devtools\r\n  const mapWrapperCode = `\r\n    import React, { useEffect, useState } from 'react';\r\n    import { Map as GoogleMapBase, useMap } from '@vis.gl/react-google-maps';\r\n\r\n    function DevtoolsPanel() {\r\n      const map = useMap();\r\n      const [mouseLatLng, setMouseLatLng] = useState(null);\r\n      const [clickedLatLng, setClickedLatLng] = useState(null);\r\n      const [placeName, setPlaceName] = useState(null);\r\n      const [zoom, setZoom] = useState(null);\r\n      const [center, setCenter] = useState(null);\r\n      const [loaded, setLoaded] = useState(false);\r\n\r\n      const copyCoords = () => {\r\n        if (!clickedLatLng) return;\r\n        const text = \\`\\${clickedLatLng.lat}, \\${clickedLatLng.lng}\\`;\r\n        navigator.clipboard.writeText(text);\r\n        alert(\"Coordenadas copiadas\");\r\n      };\r\n\r\n      useEffect(() => {\r\n        if (!map) return;\r\n        setLoaded(true);\r\n        setZoom(map.getZoom());\r\n        setCenter(map.getCenter()?.toJSON());\r\n\r\n        const mouseMoveListener = map.addListener(\"mousemove\", (e) => {\r\n          setMouseLatLng({ lat: e.latLng.lat(), lng: e.latLng.lng() });\r\n        });\r\n\r\n        const clickListener = map.addListener(\"click\", (e) => {\r\n          const point = { lat: e.latLng.lat(), lng: e.latLng.lng() };\r\n          setClickedLatLng(point);\r\n\r\n          const geocoder = new google.maps.Geocoder();\r\n          geocoder.geocode({ location: point }, (results, status) => {\r\n            if (status === \"OK\" && results[0]) {\r\n              setPlaceName(results[0].formatted_address);\r\n            } else {\r\n              setPlaceName(\"No encontrado\");\r\n            }\r\n          });\r\n        });\r\n\r\n        const zoomListener = map.addListener(\"zoom_changed\", () => {\r\n          setZoom(map.getZoom());\r\n        });\r\n\r\n        const centerListener = map.addListener(\"center_changed\", () => {\r\n          const c = map.getCenter();\r\n          if (c) setCenter(c.toJSON());\r\n        });\r\n\r\n        return () => {\r\n          google.maps.event.removeListener(mouseMoveListener);\r\n          google.maps.event.removeListener(clickListener);\r\n          google.maps.event.removeListener(zoomListener);\r\n          google.maps.event.removeListener(centerListener);\r\n        };\r\n      }, [map]);\r\n\r\n      if (!${debug}) return null;\r\n\r\n      return React.createElement(\r\n        \"div\",\r\n        {\r\n          style: {\r\n            position: \"fixed\",\r\n            bottom: \"10px\",\r\n            right: \"10px\",\r\n            padding: \"12px\",\r\n            background: \"#0009\",\r\n            color: \"white\",\r\n            borderRadius: \"8px\",\r\n            fontSize: \"12px\",\r\n            zIndex: 999999,\r\n            width: \"280px\",\r\n            lineHeight: \"1.4\",\r\n            backdropFilter: \"blur(4px)\",\r\n          }\r\n        },\r\n        React.createElement(\"div\", { style: { fontWeight: \"bold\", fontSize: \"16px\", marginBottom: \"5px\" }}, \"Google Maps Devtools\"),\r\n        React.createElement(\"div\", null, \"API Key: ${apiKey.slice(0, 5)}...****\"),\r\n        React.createElement(\"div\", null, \"Libraries: ${libraries.join(\", \")}\"),\r\n        React.createElement(\"div\", null, \"Map Loaded: \" + (loaded ? \"Sí\" : \"No\")),\r\n        React.createElement(\"hr\"),\r\n        React.createElement(\"div\", null, \"Zoom: \" + (zoom ?? \"-\")),\r\n        React.createElement(\"div\", null, \"Centro: \" + (center ? \\`\\${center.lat.toFixed(5)}, \\${center.lng.toFixed(5)}\\` : \"-\")),\r\n        React.createElement(\"div\", null, \"Mouse: \" + (mouseLatLng ? \\`\\${mouseLatLng.lat.toFixed(5)}, \\${mouseLatLng.lng.toFixed(5)}\\` : \"-\")),\r\n        React.createElement(\"div\", null, \"Click: \" + (clickedLatLng ? \\`\\${clickedLatLng.lat.toFixed(5)}, \\${clickedLatLng.lng.toFixed(5)}\\` : \"-\")),\r\n        React.createElement(\"div\", null, \"Lugar: \" + (placeName ?? \"-\")),\r\n        clickedLatLng &&\r\n          React.createElement(\r\n            \"button\",\r\n            {\r\n              style: {\r\n                marginTop: \"8px\",\r\n                width: \"100%\",\r\n                padding: \"4px\",\r\n                background: \"#22c55e\",\r\n                color: \"#000\",\r\n                border: \"none\",\r\n                borderRadius: \"4px\",\r\n                cursor: \"pointer\"\r\n              },\r\n              onClick: copyCoords\r\n            },\r\n            \"Copiar coordenadas\"\r\n          )\r\n      );\r\n    }\r\n\r\n    export function Map(props) {\r\n      const defaults = ${JSON.stringify(mapDefaults)};\r\n\r\n      return React.createElement(\r\n        React.Fragment,\r\n        null,\r\n        React.createElement(GoogleMapBase, { ...defaults, ...props }),\r\n        ${debug} && React.createElement(DevtoolsPanel)\r\n      );\r\n    }\r\n  `;\r\n\r\n  return {\r\n    name: \"vite-google-maps\",\r\n    enforce: \"pre\",\r\n\r\n    resolveId(id) {\r\n      if (id === '@google-maps/map') {\r\n        return '\\0@google-maps/map';\r\n      }\r\n    },\r\n\r\n    load(id) {\r\n      if (id === '\\0@google-maps/map') {\r\n        return mapWrapperCode;\r\n      }\r\n    },\r\n\r\n    transform(code, id) {\r\n      const isMainFile = /[\\\\/]main\\.(tsx|jsx)$/.test(id);\r\n      if (!isMainFile) return null;\r\n\r\n      // Solo auto-wrap si no está ya importado\r\n      if (code.includes(\"APIProvider\") || code.includes(\"@vis.gl/react-google-maps\")) {\r\n        return null;\r\n      }\r\n\r\n      // Auto-wrap con APIProvider\r\n      let transformedCode = `import { APIProvider } from \"@vis.gl/react-google-maps\";\\n${code}`;\r\n\r\n      const renderMatch = transformedCode.match(/\\.render\\s*\\(\\s*([\\s\\S]+)\\s*\\)\\s*[;,]?\\s*$/);\r\n\r\n      if (!renderMatch) {\r\n        console.warn(\"⚠️  [vite-plugin-google-maps] No se pudo encontrar .render()\");\r\n        return null;\r\n      }\r\n\r\n      const renderContent = renderMatch[1];\r\n      let wrappedContent;\r\n\r\n      const apiKeyStr = JSON.stringify(apiKey);\r\n      const librariesStr = JSON.stringify(libraries);\r\n\r\n      if (renderContent.includes(\"<StrictMode>\")) {\r\n        wrappedContent = renderContent.replace(\r\n          /(<StrictMode>\\s*\\n?\\s*)([\\s\\S]*?)(\\s*\\n?\\s*<\\/StrictMode>)/,\r\n          (match, opening, content, closing) => {\r\n            return `${opening}<APIProvider apiKey={${apiKeyStr}} libraries={${librariesStr}}>\\n${content}\\n    </APIProvider>${closing}`;\r\n          }\r\n        );\r\n      } else {\r\n        wrappedContent = `<APIProvider apiKey={${apiKeyStr}} libraries={${librariesStr}}>\\n${renderContent}\\n</APIProvider>`;\r\n      }\r\n\r\n      transformedCode = transformedCode.replace(renderContent, wrappedContent);\r\n\r\n      return { code: transformedCode, map: null };\r\n    },\r\n\r\n    config() {\r\n      return {\r\n        resolve: {\r\n          alias: {},\r\n        },\r\n      };\r\n    },\r\n  };\r\n}\r\n"],"mappings":"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","names":[]}